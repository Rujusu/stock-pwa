<!DOCTYPE html><html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('âœ… Service Worker registered!'));
    }
  </script>
  <meta charset="UTF-8">
  <title>Simple Stock Counter</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    button { padding: 5px 10px; margin: 0 2px; }
  </style>
  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const stockRef = collection(db, 'stock');

let stock = [];

async function loadStock() {
  stock = [];
  const snapshot = await getDocs(stockRef);
  snapshot.forEach(docSnap => {
    stock.push({ id: docSnap.id, ...docSnap.data() });
  });
  renderTable();
}

async function saveItem(name, qty) {
  await addDoc(stockRef, { name, qty });
  loadStock();
}

async function updateQty(id, newQty) {
  const itemRef = doc(db, 'stock', id);
  await updateDoc(itemRef, { qty: newQty });
  loadStock();
}

async function deleteItem(id) {
  const itemRef = doc(db, 'stock', id);
  await deleteDoc(itemRef);
  loadStock();
}

function renderTable() {
  const tbody = document.querySelector("#stockTable tbody");
  tbody.innerHTML = "";

  stock.forEach((item) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${item.name}</td>
      <td>${item.qty}</td>
      <td>
        <button onclick="changeQty('${item.id}', ${item.qty}, 1)">+</button>
        <button onclick="changeQty('${item.id}', ${item.qty}, -1)">-</button>
        <button onclick="removeItem('${item.id}')">Delete</button>
      </td>`;
    tbody.appendChild(row);
  });
}

window.addItem = async function () {
  const name = document.getElementById("itemName").value.trim();
  const qty = parseInt(document.getElementById("itemQty").value);
  if (!name || isNaN(qty)) return alert("Enter valid name and quantity");
  await saveItem(name, qty);
  document.getElementById("itemName").value = "";
  document.getElementById("itemQty").value = 1;
}

window.changeQty = async function (id, currentQty, delta) {
  const newQty = Math.max(0, currentQty + delta);
  await updateQty(id, newQty);
}

window.removeItem = async function (id) {
  await deleteItem(id);
}

window.exportCSV = function () {
  let csv = 'Item,Quantity\n';
  stock.forEach(item => {
    csv += `${item.name},${item.qty}\n`;
  });
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'stock.csv';
  a.click();
  URL.revokeObjectURL(url);
}

loadStock();

  </script>
</head>
<body>
  <h1>Stock Counting System</h1><label>Item Name: <input id="itemName" type="text"></label> <label>Quantity: <input id="itemQty" type="number" value="1"></label> <button onclick="addItem()">Add Item</button> <button onclick="exportCSV()">Export CSV</button>

  <table id="stockTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Quantity</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</body>
</html>